<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â∞èÁãêÁã∏ÊéßÂà∂Âè∞</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü¶ä</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #c8f5f5 0%, #a8e6e6 25%, #88d7d7 50%, #68c8c8 75%, #48b9b9 100%);
            font-family: "Comic Sans MS", "Microsoft YaHei", sans-serif;
            color: #444;
            min-height: 100vh;
            display: flex;
        }

        /* ‰æßËæπÊ†èÊ†∑Âºè */
        .sidebar {
            width: 280px;
            background: linear-gradient(145deg, #dceafe, #c8e0fa);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 100;
        }

        .sidebar-header {
            padding: 30px 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        }

        .sidebar-header .fox {
            font-size: 60px;
            margin-bottom: 10px;
            animation: bounce 0.8s infinite alternate;
        }

        .sidebar-header h1 {
            color: #5210ed;
            font-size: 20px;
            background: linear-gradient(45deg, #5210ed, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-menu {
            flex: 1;
            padding: 20px 0;
            overflow-y: auto;
        }

        .nav-item {
            padding: 15px 25px;
            margin: 5px 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #666;
            text-decoration: none;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.6);
            transform: translateX(5px);
            color: #5210ed;
        }

        .nav-item.active {
            background: linear-gradient(45deg, #110d77, #5210ed);
            color: white;
            box-shadow: 0 4px 15px rgba(82, 16, 237, 0.3);
        }

        .nav-item .icon {
            font-size: 20px;
            width: 24px;
            text-align: center;
        }

        .nav-item .text {
            font-size: 16px;
            font-weight: 500;
        }

        /* ‰∏ªÂÜÖÂÆπÂå∫Ê†∑Âºè */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 30px;
            min-height: 100vh;
        }

        .content-header {
            background: linear-gradient(145deg, #dceafe, #c8e0fa);
            padding: 25px 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.4);
        }

        .content-header h2 {
            color: #5210ed;
            font-size: 28px;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #5210ed, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .content-body {
            background: linear-gradient(145deg, #dceafe, #c8e0fa);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            min-height: 500px;
        }

        /* Âä®ÁîªÊïàÊûú */
        @keyframes bounce {
            from {
                transform: translateY(0);
            }

            to {
                transform: translateY(-5px);
            }
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
            }

            .sidebar-header h1,
            .nav-item .text {
                display: none;
            }

            .main-content {
                margin-left: 70px;
            }
        }

        .dashboard-grid {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .metric-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.12);
        }

        .metric-card.small {
            padding: 20px;
            text-align: center;
            justify-content: center;
        }
        
        /* Á´ôÁÇπË°åËÉåÊôØÈ¢úËâ≤ */
        .row-alive {
            background-color: rgba(76, 175, 80, 0.15);
            transition: background-color 0.5s ease;
        }
        .row-alive:hover {
            background-color: rgba(76, 175, 80, 0.25);
        }
        .row-dead {
            background-color: rgba(244, 67, 54, 0.15);
            transition: background-color 0.5s ease;
        }
        .row-dead:hover {
            background-color: rgba(244, 67, 54, 0.25);
        }
        
        /* Êìç‰ΩúÊåâÈíÆÂÆπÂô® */
        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .metric-icon {
            font-size: 32px;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #5210ed, #8b5cf6);
            border-radius: 12px;
            color: white;
        }

        .metric-content {
            flex: 1;
        }

        .metric-value {
            font-size: 28px;
            font-weight: bold;
            color: #5210ed;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }

        .refresh-section {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.3);
        }

        .refresh-btn {
            background: linear-gradient(135deg, #5210ed, #8b5cf6);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(82, 16, 237, 0.3);
        }

        .refresh-icon {
            font-size: 16px;
        }

        .last-update {
            font-size: 14px;
            color: #666;
        }

        /* Ë°®Ê†ºÊ†∑Âºè */
        .table-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        th {
            background: linear-gradient(135deg, #5210ed, #8b5cf6);
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background-color: rgba(82, 16, 237, 0.05);
        }

        /* Ë°®ÂçïÊ†∑Âºè */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #5210ed;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid rgba(82, 16, 237, 0.2);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #5210ed;
            box-shadow: 0 0 0 3px rgba(82, 16, 237, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #5210ed, #8b5cf6);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(82, 16, 237, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff4757, #ff6b81);
        }

        .btn-success {
            background: linear-gradient(135deg, #2ed573, #7bed9f);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #a4b0be, #747d8c);
        }

        /* Âç°ÁâáÊ†∑Âºè */
        .card {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.3);
            margin-bottom: 20px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .card-title {
            font-size: 20px;
            font-weight: 600;
            color: #5210ed;
        }

        /* Ê†áÁ≠æÈ°µÊ†∑Âºè */
        .tabs {
            display: flex;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab.active {
            border-bottom-color: #5210ed;
            color: #5210ed;
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Áä∂ÊÄÅÊåáÁ§∫Âô® */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-active {
            background: rgba(46, 213, 115, 0.2);
            color: #2ed573;
        }

        .status-inactive {
            background: rgba(255, 71, 87, 0.2);
            color: #ff4757;
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 768px) {
            .metric-row {
                grid-template-columns: 1fr;
            }
            
            .refresh-section {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .table-container {
                overflow-x: auto;
            }
        }

        /* Âä†ËΩΩÂä®Áîª */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Ê∂àÊÅØÊèêÁ§∫ */
        .alert {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: rgba(46, 213, 115, 0.2);
            color: #2ed573;
            border: 1px solid rgba(46, 213, 115, 0.3);
        }

        .alert-error {
            background: rgba(255, 71, 87, 0.2);
            color: #ff4757;
            border: 1px solid rgba(255, 71, 87, 0.3);
        }

        /* Ê®°ÊÄÅÊ°Ü */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: #5210ed;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        /* ÂàÜÈ°µÊ†∑Âºè */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }

        .page-btn {
            padding: 8px 12px;
            border: 1px solid rgba(82, 16, 237, 0.2);
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .page-btn.active {
            background: #5210ed;
            color: white;
        }

        .page-btn:hover:not(.active) {
            background: rgba(82, 16, 237, 0.1);
        }
        /* Âú®Áé∞ÊúâÁöÑCSS‰∏≠Ê∑ªÂä†‰ª•‰∏ãÊ†∑Âºè */
        .status-indicator.clickable {
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
        }

        .status-indicator.clickable:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .status-indicator.clickable:active {
            transform: scale(0.95);
        }

        /* Âú®Áé∞ÊúâÁöÑCSS‰∏≠Ê∑ªÂä† */
.code-block {
    background: #f8f9fa;
    padding: 10px;
    border-radius: 5px;
    font-family: 'Courier New', monospace;
    white-space: pre-wrap;
    word-break: break-all;
    border: 1px solid #e9ecef;
}

.detail-section {
    margin-bottom: 20px;
}

.detail-section h4 {
    color: #5210ed;
    margin-bottom: 10px;
    padding-bottom: 5px;
    border-bottom: 2px solid #5210ed;
}
/* Âú®Áé∞ÊúâÁöÑCSS‰∏≠Ê∑ªÂä†‰ª•‰∏ãÊ†∑Âºè */
.http-request {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 20px;
    font-family: 'Courier New', monospace;
    white-space: pre-wrap;
    word-break: break-all;
    line-height: 1.4;
    font-size: 13px;
    max-height: 400px;
    overflow-y: auto;
    margin-top: 10px;
}

.http-request-line {
    color: #d63384;
    font-weight: bold;
}

.http-header {
    color: #0d6efd;
}

.http-body {
    color: #198754;
    margin-top: 10px;
}

.copy-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 10;
    padding: 5px 10px;
    font-size: 12px;
    background: rgba(82, 16, 237, 0.1);
    border: 1px solid rgba(82, 16, 237, 0.2);
}

.copy-btn:hover {
    background: rgba(82, 16, 237, 0.2);
}

/* Âú®Áé∞ÊúâÁöÑCSS‰∏≠Ê∑ªÂä†‰ª•‰∏ãÊ†∑Âºè */
.http-request {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 20px;
    font-family: 'Courier New', monospace;
    white-space: pre-wrap;
    word-break: break-all;
    line-height: 1.4;
    font-size: 13px;
    max-height: 400px;
    overflow-y: auto;
    margin-top: 10px;
}

.http-request-line {
    color: #d63384;
    font-weight: bold;
}

.http-header {
    color: #0d6efd;
}

.http-body {
    color: #198754;
    margin-top: 10px;
}

.copy-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 10;
    padding: 5px 10px;
    font-size: 12px;
    background: rgba(82, 16, 237, 0.1);
    border: 1px solid rgba(82, 16, 237, 0.2);
}

.copy-btn:hover {
    background: rgba(82, 16, 237, 0.2);
}

    </style>
</head>

<body>
    <!-- ‰æßËæπÂØºËà™Ê†è -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="fox">ü¶ä</div>
            <h1>Â∞èÁãêÁã∏ÊéßÂà∂Âè∞</h1>
        </div>

        <div class="nav-menu">
            <a href="javascript:void(0)" class="nav-item active" data-page="dashboard">
                <span class="icon">üìä</span>
                <span class="text">Êï∞ÊçÆÊ¶ÇËßà</span>
            </a>
            <a href="javascript:void(0)" class="nav-item" data-page="acl">
                <span class="icon">üõ°Ô∏è</span>
                <span class="text">ACLËßÑÂàô</span>
            </a>
            <a href="javascript:void(0)" class="nav-item" data-page="cache">
                <span class="icon">‚ö°</span>
                <span class="text">ÁºìÂ≠òÁÆ°ÁêÜ</span>
            </a>
            <a href="javascript:void(0)" class="nav-item" data-page="sites">
                <span class="icon">üåê</span>
                <span class="text">Á´ôÁÇπÁÆ°ÁêÜ</span>
            </a>
            <a href="javascript:void(0)" class="nav-item" data-page="logs">
                <span class="icon">üìù</span>
                <span class="text">ÊîªÂáªÊó•Âøó</span>
            </a>
            <a href="javascript:void(0)" class="nav-item" data-page="settings">
                <span class="icon">‚öôÔ∏è</span>
                <span class="text">Á≥ªÁªüËÆæÁΩÆ</span>
            </a>
        </div>
    </div>

    <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
    <div class="main-content">
        <div class="content-header">
            <h2 id="page-title">Êï∞ÊçÆÊ¶ÇËßà</h2>
            <p id="page-description">Ê¨¢ËøéÊù•Âà∞Â∞èÁãêÁã∏WAFÊéßÂà∂Âè∞</p>
        </div>

        <div class="content-body" id="content-container">
            <!-- ÂÜÖÂÆπÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÂä†ËΩΩ -->
        </div>
    </div>

    <!-- Ê®°ÊÄÅÊ°Ü -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">Ê®°ÊÄÅÊ°ÜÊ†áÈ¢ò</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div id="modal-body">
                <!-- Ê®°ÊÄÅÊ°ÜÂÜÖÂÆπ -->
            </div>
        </div>
    </div>

    <script>
        // ÂÖ®Â±ÄÂèòÈáè
        let currentPage = 'dashboard';
        let currentLogsPage = 1;
        let currentLogsPageSize = 20;
        let currentLogsTotal = 0;

        // È°µÈù¢ÂÜÖÂÆπÂÆö‰πâ
        const pageContents = {
            dashboard: {
                title: "Êï∞ÊçÆÊ¶ÇËßà",
                description: "Á≥ªÁªüËøêË°åÁä∂ÊÄÅÂíåÁªüËÆ°‰ø°ÊÅØ",
                content: `
                    <div class="dashboard-grid">
                        <div class="metric-row">
                            <div class="metric-card">
                                <div class="metric-icon">üåê</div>
                                <div class="metric-content">
                                    <div class="metric-value" id="total-requests">0</div>
                                    <div class="metric-label">ÊÄªËØ∑Ê±ÇÊï∞</div>
                                </div>
                            </div>
                            
                            <div class="metric-card">
                                <div class="metric-icon">üõ°Ô∏è</div>
                                <div class="metric-content">
                                    <div class="metric-value" id="blocked-requests">0</div>
                                    <div class="metric-label">Êã¶Êà™ÊîªÂáª</div>
                                </div>
                            </div>
                            
                            <div class="metric-card">
                                <div class="metric-icon">‚ö°</div>
                                <div class="metric-content">
                                    <div class="metric-value" id="cache-hit-rate">0%</div>
                                    <div class="metric-label">ÁºìÂ≠òÂëΩ‰∏≠Áéá</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="metric-row">
                            <div class="metric-card">
                                <div class="metric-icon">üìã</div>
                                <div class="metric-content">
                                    <div class="metric-value" id="total-rules">0</div>
                                    <div class="metric-label">WAFËßÑÂàô</div>
                                </div>
                            </div>
                            
                            <div class="metric-card">
                                <div class="metric-icon">üåç</div>
                                <div class="metric-content">
                                    <div class="metric-value" id="total-sites">0</div>
                                    <div class="metric-label">‰ª£ÁêÜÁ´ôÁÇπ</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="refresh-section">
                            <button class="refresh-btn" onclick="refreshStats()">
                                <span class="refresh-icon">üîÑ</span>
                                Âà∑Êñ∞Êï∞ÊçÆ
                            </button>
                            <div class="last-update">ÊúÄÂêéÊõ¥Êñ∞: <span id="last-update">ÂàöÂàö</span></div>
                        </div>
                    </div>
                `
            },
            acl: {
                title: "ACLËßÑÂàôÁÆ°ÁêÜ",
                description: "ËÆøÈóÆÊéßÂà∂ÂàóË°®ËßÑÂàôÈÖçÁΩÆ",
                content: `
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">üõ°Ô∏è ACLËßÑÂàôÂàóË°®</h3>
                            <button class="btn" onclick="showAddACLModal()">
                                <span>+</span> Ê∑ªÂä†ËßÑÂàô
                            </button>
                        </div>
                        <div id="acl-rules-container">
                            <div class="loading">Âä†ËΩΩ‰∏≠...</div>
                        </div>
                    </div>
                `
            },
            cache: {
                title: "ÁºìÂ≠òÁÆ°ÁêÜ", 
                description: "ÈùôÊÄÅÁºìÂ≠òÈÖçÁΩÆÂíåÁªüËÆ°",
                content: `
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">‚ö° ÁºìÂ≠òÁªüËÆ°</h3>
                            <div>
                                <button class="btn btn-secondary" onclick="clearCache()">
                                    <span>üóëÔ∏è</span> Ê∏ÖÁ©∫ÁºìÂ≠ò
                                </button>
                                <button class="btn" onclick="refreshCacheStats()">
                                    <span>üîÑ</span> Âà∑Êñ∞
                                </button>
                            </div>
                        </div>
                        <div id="cache-stats-container">
                            <div class="loading">Âä†ËΩΩ‰∏≠...</div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">‚öôÔ∏è ÁºìÂ≠òÈÖçÁΩÆ</h3>
                        </div>
                        <div id="cache-config-container">
                            <div class="loading">Âä†ËΩΩ‰∏≠...</div>
                        </div>
                    </div>
                `
            },
            sites: {
                title: "Á´ôÁÇπÁÆ°ÁêÜ",
                description: "ÂèçÂêë‰ª£ÁêÜÁ´ôÁÇπÈÖçÁΩÆ",
                content: `
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">üåê Á´ôÁÇπÂàóË°®</h3>
                            <button class="btn" onclick="showAddSiteModal()">
                                <span>+</span> Ê∑ªÂä†Á´ôÁÇπ
                            </button>
                        </div>
                        <div id="sites-container">
                            <div class="loading">Âä†ËΩΩ‰∏≠...</div>
                        </div>
                    </div>
                `
            },
            logs: {
                title: "ÊîªÂáªÊó•Âøó",
                description: "Êü•ÁúãÂíåÂàÜÊûêÊîªÂáªËÆ∞ÂΩï",
                content: `
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">üìù ÊîªÂáªÊó•Âøó</h3>
                            <div>
                                <button class="btn btn-secondary" onclick="exportLogs()">
                                    <span>üì§</span> ÂØºÂá∫Êó•Âøó
                                </button>
                                <button class="btn btn-danger" onclick="showDeleteLogsModal()">
                                    <span>üóëÔ∏è</span> Âà†Èô§Êó•Âøó
                                </button>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <select id="log-method-filter" class="form-control" style="width: 150px;">
                                    <option value="">ÊâÄÊúâÊñπÊ≥ï</option>
                                    <option value="GET">GET</option>
                                    <option value="POST">POST</option>
                                    <option value="PUT">PUT</option>
                                    <option value="DELETE">DELETE</option>
                                </select>
                                <input type="text" id="log-rule-filter" class="form-control" placeholder="ËßÑÂàôÂêçÁß∞" style="width: 200px;">
                                <input type="date" id="log-start-date" class="form-control" style="width: 150px;">
                                <input type="date" id="log-end-date" class="form-control" style="width: 150px;">
                                <button class="btn" onclick="loadAttackLogs(1)">
                                    <span>üîç</span> ÊêúÁ¥¢
                                </button>
                            </div>
                        </div>
                        
                        <div id="logs-container">
                            <div class="loading">Âä†ËΩΩ‰∏≠...</div>
                        </div>
                        
                        <div id="logs-pagination" class="pagination"></div>
                    </div>
                `
            },
            settings: {
                title: "Á≥ªÁªüËÆæÁΩÆ",
                description: "Á≥ªÁªüÈÖçÁΩÆÂíåÂèÇÊï∞Ë∞ÉÊï¥",
                content: `
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">‚öôÔ∏è Á≥ªÁªüËÆæÁΩÆ</h3>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Èò≤ÂºÄÂèëËÄÖÂ∑•ÂÖ∑</label>
                            <div>
                                <label style="display: inline-flex; align-items: center; gap: 8px; margin-right: 20px;">
                                    <input type="radio" name="anti-devtools" value="true" checked> ÂêØÁî®
                                </label>
                                <label style="display: inline-flex; align-items: center; gap: 8px;">
                                    <input type="radio" name="anti-devtools" value="false"> Á¶ÅÁî®
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">ËßÑÂàôÂåπÈÖçÁéá (%)</label>
                            <input type="range" id="rule-match-rate" min="0" max="100" value="100" class="form-control">
                            <div id="rule-match-rate-value" style="text-align: center; margin-top: 5px;">100%</div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Base64 Ëß£Á†ÅÊ∑±Â∫¶</label>
                            <input type="number" id="base64-depth" min="0" max="10" value="2" class="form-control">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">URL Ëß£Á†ÅÊ∑±Â∫¶</label>
                            <input type="number" id="url-depth" min="0" max="10" value="2" class="form-control">
                        </div>
                        
                        <button class="btn" onclick="saveSettings()">
                            <span>üíæ</span> ‰øùÂ≠òËÆæÁΩÆ
                        </button>
                    </div>
                `
            }
        };

        // È°µÈù¢ÂàáÊç¢ÂäüËÉΩ
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                // ÁßªÈô§ÊâÄÊúâactiveÁ±ª
                document.querySelectorAll('.nav-item').forEach(nav => {
                    nav.classList.remove('active');
                });
                // Ê∑ªÂä†ÂΩìÂâçactiveÁ±ª
                this.classList.add('active');
                
                // Ëé∑ÂèñÈ°µÈù¢Ê†áËØÜ
                const pageId = this.getAttribute('data-page');
                loadPage(pageId);
            });
        });

        // Âä†ËΩΩÈ°µÈù¢ÂÜÖÂÆπ
        function loadPage(pageId) {
            currentPage = pageId;
            const page = pageContents[pageId];
            if (page) {
                document.getElementById('page-title').textContent = page.title;
                document.getElementById('page-description').textContent = page.description;
                document.getElementById('content-container').innerHTML = page.content;
                
                // Âä†ËΩΩÈ°µÈù¢ÁâπÂÆöÊï∞ÊçÆ
                switch(pageId) {
                    case 'dashboard':
                        loadStats();
                        break;
                    case 'acl':
                        loadACLRules();
                        break;
                    case 'cache':
                        loadCacheStats();
                        loadCacheConfig();
                        break;
                    case 'sites':
                        loadSites();
                        break;
                    case 'logs':
                        loadAttackLogs(1);
                        break;
                    case 'settings':
                        loadSettings();
                        break;
                }
            }
        }

        // Âä†ËΩΩÁªüËÆ°Êï∞ÊçÆ
        async function loadStats() {
            try {
                const response = await fetch('/api/stats', {
                    method: 'GET',
                    credentials: 'include'
                });

                if (response.ok) {
                    const stats = await response.json();

                    // Êõ¥Êñ∞È°µÈù¢ÊòæÁ§∫
                    document.getElementById('total-requests').textContent = stats.total_requests.toLocaleString();
                    document.getElementById('blocked-requests').textContent = stats.blocked_requests.toLocaleString();
                    document.getElementById('cache-hit-rate').textContent = stats.cache_hit_rate;
                    document.getElementById('total-rules').textContent = stats.total_rules;
                    document.getElementById('total-sites').textContent = stats.total_sites;
                    
                    // Êõ¥Êñ∞ÊúÄÂêéÊõ¥Êñ∞Êó∂Èó¥
                    document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
                } else {
                    console.error('Ëé∑ÂèñÁªüËÆ°Êï∞ÊçÆÂ§±Ë¥•:', response.status);
                }
            } catch (error) {
                console.error('Ëé∑ÂèñÁªüËÆ°Êï∞ÊçÆÈîôËØØ:', error);
            }
        }

        // Âà∑Êñ∞ÁªüËÆ°Êï∞ÊçÆ
        function refreshStats() {
            loadStats();
        }

        // Âä†ËΩΩACLËßÑÂàô
        async function loadACLRules() {
            try {
                const response = await fetch('/api/acl/rules', {
                    method: 'GET',
                    credentials: 'include'
                });

                if (response.ok) {
                    const data = await response.json();
                    displayACLRules(data.rules);
                } else {
                    document.getElementById('acl-rules-container').innerHTML = '<div class="alert alert-error">Âä†ËΩΩACLËßÑÂàôÂ§±Ë¥•</div>';
                }
            } catch (error) {
                console.error('Âä†ËΩΩACLËßÑÂàôÈîôËØØ:', error);
                document.getElementById('acl-rules-container').innerHTML = '<div class="alert alert-error">Âä†ËΩΩACLËßÑÂàôÂ§±Ë¥•</div>';
            }
        }

        // ÊòæÁ§∫ACLËßÑÂàô
        function displayACLRules(rules) {
            const container = document.getElementById('acl-rules-container');
            
            if (!rules || rules.length === 0) {
                container.innerHTML = '<div class="alert">ÊöÇÊó†ACLËßÑÂàô</div>';
                return;
            }
            
            let html = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Á±ªÂûã</th>
                                <th>‰∏ªÊú∫</th>
                                <th>ËßÑÂàôÁ±ªÂûã</th>
                                <th>Ê®°Âºè</th>
                                <th>Âä®‰Ωú</th>
                                <th>ÊèèËø∞</th>
                                <th>Áä∂ÊÄÅ</th>
                                <th>Êìç‰Ωú</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            rules.forEach(rule => {
                html += `
                    <tr>
                        <td>${rule.id}</td>
                        <td>${rule.type}</td>
                        <td>${rule.host || '-'}</td>
                        <td>${rule.rule_type}</td>
                        <td title="${rule.pattern}">${rule.pattern.length > 30 ? rule.pattern.substring(0, 30) + '...' : rule.pattern}</td>
                        <td>
                            <span class="status-indicator ${rule.action === 'allow' ? 'status-active' : 'status-inactive'}">
                                ${rule.action === 'allow' ? 'ÂÖÅËÆ∏' : 'ÈòªÊ≠¢'}
                            </span>
                        </td>
                        <td>${rule.description || '-'}</td>
                        <td>
                            <span class="status-indicator ${rule.enabled ? 'status-active' : 'status-inactive'}">
                                ${rule.enabled ? 'ÂêØÁî®' : 'Á¶ÅÁî®'}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-danger" onclick="deleteACLRule(${rule.id})">Âà†Èô§</button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            container.innerHTML = html;
        }

        // ÊòæÁ§∫Ê∑ªÂä†ACLËßÑÂàôÊ®°ÊÄÅÊ°Ü
        function showAddACLModal() {
            document.getElementById('modal-title').textContent = 'Ê∑ªÂä†ACLËßÑÂàô';
            document.getElementById('modal-body').innerHTML = `
                <form id="add-acl-form">
                    <div class="form-group">
                        <label class="form-label">ËßÑÂàôÁ±ªÂûã</label>
                        <select name="type" class="form-control" required>
                            <option value="global">ÂÖ®Â±ÄËßÑÂàô</option>
                            <option value="host">‰∏ªÊú∫ËßÑÂàô</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="host-field" style="display: none;">
                        <label class="form-label">‰∏ªÊú∫Âêç</label>
                        <input type="text" name="host" class="form-control" placeholder="‰æãÂ¶Ç: example.com">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ËßÑÂàôÁ±ªÂûã</label>
                        <select name="rule_type" class="form-control" required>
                            <option value="ip">IPÂú∞ÂùÄ</option>
                            <option value="user_agent">User Agent</option>
                            <option value="referer">Referer</option>
                            <option value="path">Ë∑ØÂæÑ</option>
                            <option value="country">ÂõΩÂÆ∂</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ÂåπÈÖçÊ®°Âºè</label>
                        <input type="text" name="pattern" class="form-control" placeholder="‰æãÂ¶Ç: 192.168.1.* Êàñ ^/admin" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Âä®‰Ωú</label>
                        <div>
                            <label style="display: inline-flex; align-items: center; gap: 8px; margin-right: 20px;">
                                <input type="radio" name="action" value="allow" checked> ÂÖÅËÆ∏
                            </label>
                            <label style="display: inline-flex; align-items: center; gap: 8px;">
                                <input type="radio" name="action" value="block"> ÈòªÊ≠¢
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ÊèèËø∞</label>
                        <textarea name="description" class="form-control" placeholder="ËßÑÂàôÊèèËø∞"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label style="display: inline-flex; align-items: center; gap: 8px;">
                            <input type="checkbox" name="enabled" checked> ÂêØÁî®ËßÑÂàô
                        </label>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button type="button" class="btn btn-secondary" onclick="closeModal()">ÂèñÊ∂à</button>
                        <button type="submit" class="btn">Ê∑ªÂä†ËßÑÂàô</button>
                    </div>
                </form>
            `;
            
            // ÊòæÁ§∫/ÈöêËóè‰∏ªÊú∫Â≠óÊÆµ
            document.querySelector('select[name="type"]').addEventListener('change', function() {
                document.getElementById('host-field').style.display = this.value === 'host' ? 'block' : 'none';
            });
            
            // Ë°®ÂçïÊèê‰∫§
            document.getElementById('add-acl-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addACLRule(new FormData(this));
            });
            
            showModal();
        }

        // Ê∑ªÂä†ACLËßÑÂàô
        async function addACLRule(formData) {
            try {
                const data = Object.fromEntries(formData);
                data.enabled = data.enabled === 'on';
                
                const response = await fetch('/api/acl/rules', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    closeModal();
                    showMessage('ACLËßÑÂàôÊ∑ªÂä†ÊàêÂäü', 'success');
                    loadACLRules();
                } else {
                    const error = await response.text();
                    showMessage('Ê∑ªÂä†Â§±Ë¥•: ' + error, 'error');
                }
            } catch (error) {
                console.error('Ê∑ªÂä†ACLËßÑÂàôÈîôËØØ:', error);
                showMessage('Ê∑ªÂä†Â§±Ë¥•', 'error');
            }
        }

        // Âà†Èô§ACLËßÑÂàô
        async function deleteACLRule(id) {
            if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÊù°ACLËßÑÂàôÂêóÔºü')) return;
            
            try {
                const response = await fetch(`/api/acl/rules/${id}`, {
                    method: 'DELETE',
                    credentials: 'include'
                });

                if (response.ok) {
                    showMessage('ACLËßÑÂàôÂà†Èô§ÊàêÂäü', 'success');
                    loadACLRules();
                } else {
                    showMessage('Âà†Èô§Â§±Ë¥•', 'error');
                }
            } catch (error) {
                console.error('Âà†Èô§ACLËßÑÂàôÈîôËØØ:', error);
                showMessage('Âà†Èô§Â§±Ë¥•', 'error');
            }
        }

        // Âä†ËΩΩÁºìÂ≠òÁªüËÆ°
        async function loadCacheStats() {
            try {
                const response = await fetch('/api/cache/stats', {
                    method: 'GET',
                    credentials: 'include'
                });

                if (response.ok) {
                    const stats = await response.json();
                    displayCacheStats(stats);
                } else {
                    document.getElementById('cache-stats-container').innerHTML = '<div class="alert alert-error">Âä†ËΩΩÁºìÂ≠òÁªüËÆ°Â§±Ë¥•</div>';
                }
            } catch (error) {
                console.error('Âä†ËΩΩÁºìÂ≠òÁªüËÆ°ÈîôËØØ:', error);
                document.getElementById('cache-stats-container').innerHTML = '<div class="alert alert-error">Âä†ËΩΩÁºìÂ≠òÁªüËÆ°Â§±Ë¥•</div>';
            }
        }

        // ÊòæÁ§∫ÁºìÂ≠òÁªüËÆ°
        function displayCacheStats(stats) {
            const container = document.getElementById('cache-stats-container');
            
            container.innerHTML = `
                <div class="metric-row">
                    <div class="metric-card">
                        <div class="metric-icon">üìä</div>
                        <div class="metric-content">
                            <div class="metric-value">${stats.cache_hits}</div>
                            <div class="metric-label">ÁºìÂ≠òÂëΩ‰∏≠</div>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-icon">üìâ</div>
                        <div class="metric-content">
                            <div class="metric-value">${stats.cache_misses}</div>
                            <div class="metric-label">ÁºìÂ≠òÊú™ÂëΩ‰∏≠</div>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-icon">üìà</div>
                        <div class="metric-content">
                            <div class="metric-value">${stats.hit_rate}</div>
                            <div class="metric-label">ÂëΩ‰∏≠Áéá</div>
                        </div>
                    </div>
                </div>
                
                <div class="metric-row">
                    <div class="metric-card">
                        <div class="metric-icon">üíæ</div>
                        <div class="metric-content">
                            <div class="metric-value">${stats.current_size}</div>
                            <div class="metric-label">ÂΩìÂâçÂ§ßÂ∞è</div>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-icon">üìÅ</div>
                        <div class="metric-content">
                            <div class="metric-value">${stats.cached_files}</div>
                            <div class="metric-label">ÁºìÂ≠òÊñá‰ª∂Êï∞</div>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-icon">üîí</div>
                        <div class="metric-content">
                            <div class="metric-value">${stats.enable ? 'ÂêØÁî®' : 'Á¶ÅÁî®'}</div>
                            <div class="metric-label">ÁºìÂ≠òÁä∂ÊÄÅ</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Âä†ËΩΩÁºìÂ≠òÈÖçÁΩÆ
        async function loadCacheConfig() {
            try {
                const response = await fetch('/api/cache/stats', {
                    method: 'GET',
                    credentials: 'include'
                });

                if (response.ok) {
                    const stats = await response.json();
                    displayCacheConfig(stats);
                } else {
                    document.getElementById('cache-config-container').innerHTML = '<div class="alert alert-error">Âä†ËΩΩÁºìÂ≠òÈÖçÁΩÆÂ§±Ë¥•</div>';
                }
            } catch (error) {
                console.error('Âä†ËΩΩÁºìÂ≠òÈÖçÁΩÆÈîôËØØ:', error);
                document.getElementById('cache-config-container').innerHTML = '<div class="alert alert-error">Âä†ËΩΩÁºìÂ≠òÈÖçÁΩÆÂ§±Ë¥•</div>';
            }
        }

        // ÊòæÁ§∫ÁºìÂ≠òÈÖçÁΩÆ
        function displayCacheConfig(stats) {
            const container = document.getElementById('cache-config-container');
            
            container.innerHTML = `
                <form id="cache-config-form">
                    <div class="form-group">
                        <label class="form-label">ÂêØÁî®ÁºìÂ≠ò</label>
                        <div>
                            <label style="display: inline-flex; align-items: center; gap: 8px; margin-right: 20px;">
                                <input type="radio" name="enable" value="true" ${stats.enable ? 'checked' : ''}> ÂêØÁî®
                            </label>
                            <label style="display: inline-flex; align-items: center; gap: 8px;">
                                <input type="radio" name="enable" value="false" ${!stats.enable ? 'checked' : ''}> Á¶ÅÁî®
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ÊúÄÂ§ßÁºìÂ≠òÂ§ßÂ∞è (MB)</label>
                        <input type="number" name="max_size_mb" class="form-control" value="${parseInt(stats.max_size)}">
                    </div>
                    
                    <button type="submit" class="btn">‰øùÂ≠òÈÖçÁΩÆ</button>
                </form>
            `;
            
            document.getElementById('cache-config-form').addEventListener('submit', function(e) {
                e.preventDefault();
                updateCacheConfig(new FormData(this));
            });
        }

        // Êõ¥Êñ∞ÁºìÂ≠òÈÖçÁΩÆ
        async function updateCacheConfig(formData) {
            try {
                const data = Object.fromEntries(formData);
                data.enable = data.enable === 'true';
                data.max_size_mb = parseInt(data.max_size_mb);
                
                const response = await fetch('/api/cache/config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    showMessage('ÁºìÂ≠òÈÖçÁΩÆÊõ¥Êñ∞ÊàêÂäü', 'success');
                    loadCacheStats();
                    loadCacheConfig();
                } else {
                    showMessage('Êõ¥Êñ∞Â§±Ë¥•', 'error');
                }
            } catch (error) {
                console.error('Êõ¥Êñ∞ÁºìÂ≠òÈÖçÁΩÆÈîôËØØ:', error);
                showMessage('Êõ¥Êñ∞Â§±Ë¥•', 'error');
            }
        }

        // Ê∏ÖÁ©∫ÁºìÂ≠ò
        async function clearCache() {
            if (!confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÁºìÂ≠òÂêóÔºü')) return;
            
            try {
                const response = await fetch('/api/cache/clear', {
                    method: 'POST',
                    credentials: 'include'
                });

                if (response.ok) {
                    showMessage('ÁºìÂ≠òÂ∑≤Ê∏ÖÁ©∫', 'success');
                    loadCacheStats();
                } else {
                    showMessage('Ê∏ÖÁ©∫ÁºìÂ≠òÂ§±Ë¥•', 'error');
                }
            } catch (error) {
                console.error('Ê∏ÖÁ©∫ÁºìÂ≠òÈîôËØØ:', error);
                showMessage('Ê∏ÖÁ©∫ÁºìÂ≠òÂ§±Ë¥•', 'error');
            }
        }

        // Âà∑Êñ∞ÁºìÂ≠òÁªüËÆ°
        function refreshCacheStats() {
            loadCacheStats();
            loadCacheConfig();
        }

        // ÂàáÊç¢Á´ôÁÇπÁä∂ÊÄÅ
async function toggleSiteStatus(siteId, newStatus) {
    const action = newStatus === 1 ? 'ÂêØÁî®' : 'Á¶ÅÁî®';
    
    if (!confirm(`Á°ÆÂÆöË¶Å${action}Ëøô‰∏™Á´ôÁÇπÂêóÔºü`)) return;
    
    try {
        const response = await fetch('/api/site/status', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            credentials: 'include',
            body: JSON.stringify({ 
                id: parseInt(siteId), 
                status: parseInt(newStatus)
            })
        });

        if (response.ok) {
            showMessage(`Á´ôÁÇπ${action}ÊàêÂäü`, 'success');
            loadSites();
        } else {
            const error = await response.text();
            showMessage(`${action}Â§±Ë¥•: ${error}`, 'error');
        }
    } catch (error) {
        console.error(`${action}Á´ôÁÇπÈîôËØØ:`, error);
        showMessage(`${action}Â§±Ë¥•`, 'error');
    }
}

        // Âä†ËΩΩÁ´ôÁÇπÂàóË°®
        async function loadSites() {
            try {
                const response = await fetch('/api/sites', {
                    method: 'GET',
                    credentials: 'include'
                });

                if (response.ok) {
                    const data = await response.json();
                    displaySites(data.sites);
                } else {
                    document.getElementById('sites-container').innerHTML = '<div class="alert alert-error">Âä†ËΩΩÁ´ôÁÇπÂàóË°®Â§±Ë¥•</div>';
                }
            } catch (error) {
                console.error('Âä†ËΩΩÁ´ôÁÇπÂàóË°®ÈîôËØØ:', error);
                document.getElementById('sites-container').innerHTML = '<div class="alert alert-error">Âä†ËΩΩÁ´ôÁÇπÂàóË°®Â§±Ë¥•</div>';
            }
        }

        // ÊòæÁ§∫Á´ôÁÇπÂàóË°®
    // ‰øÆÊîπdisplaySitesÂáΩÊï∞ÔºåÊòæÁ§∫ËØÅ‰π¶‰ø°ÊÅØ
    function displaySites(sites) {
        const container = document.getElementById('sites-container');

        if (!sites || sites.length === 0) {
            container.innerHTML = '<div class="alert">ÊöÇÊó†Á´ôÁÇπ</div>';
            return;
        }

        let html = `
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>ÂêçÁß∞</th>
                        <th>ÂüüÂêç</th>
                        <th>ÁõÆÊ†áURL</th>
                        <th>HTTPS</th>
                        <th>ËØÅ‰π¶Áä∂ÊÄÅ</th>
                        <th>Á´ôÁÇπÁä∂ÊÄÅ</th>
                        <th>Êìç‰Ωú</th>
                    </tr>
                </thead>
                <tbody>
    `;

        sites.forEach(site => {
            // Ëé∑ÂèñÁ´ôÁÇπÂÅ•Â∫∑Áä∂ÊÄÅ
            const isTargetAlive = window.siteHealthData && window.siteHealthData[site.id] ? window.siteHealthData[site.id].is_alive : false;
            const rowClass = isTargetAlive ? 'row-alive' : 'row-dead';

            // ËØÅ‰π¶Áä∂ÊÄÅ
            let certStatus = '';
            if (site.enable_https) {
                if (site.cert_id) {
                    certStatus = '<span class="status-indicator status-active" title="Â∑≤ÈÖçÁΩÆËØÅ‰π¶">‚úÖ Â∑≤ÈÖçÁΩÆ</span>';
                } else {
                    certStatus = '<span class="status-indicator status-inactive" title="Êú™ÈÖçÁΩÆËØÅ‰π¶">‚ùå Êó†ËØÅ‰π¶</span>';
                }
            } else {
                certStatus = '<span class="status-indicator">-</span>';
            }

            html += `
            <tr class="${rowClass}">
                <td>${site.id}</td>
                <td>${site.name}</td>
                <td>${site.domain}</td>
                <td title="${site.target_url}">${site.target_url.length > 30 ? site.target_url.substring(0, 30) + '...' : site.target_url}</td>
                <td>
                    <span class="status-indicator ${site.enable_https ? 'status-active' : 'status-inactive'} clickable" 
                          onclick="toggleSiteHTTPS(${site.id}, ${!site.enable_https})"
                          title="ÁÇπÂáªÂàáÊç¢HTTPSÁä∂ÊÄÅ">
                        ${site.enable_https ? 'ÂêØÁî®' : 'Á¶ÅÁî®'}
                    </span>
                </td>
                <td>${certStatus}</td>
                <td>
                    <span class="status-indicator ${site.status === 1 ? 'status-active' : 'status-inactive'} clickable" 
                          onclick="toggleSiteStatus(${site.id}, ${site.status === 1 ? 0 : 1})"
                          title="ÁÇπÂáªÂàáÊç¢Á´ôÁÇπÁä∂ÊÄÅ">
                        ${site.status === 1 ? 'ÂêØÁî®' : 'Á¶ÅÁî®'}
                    </span>
                </td>
                <td>
                    <div class="action-buttons">
                        ${site.enable_https ? `
                            <button class="btn" onclick="manageSiteCertificate(${site.id}, '${site.domain}')" title="ÁÆ°ÁêÜËØÅ‰π¶">üìú</button>
                        ` : ''}
                        <button class="btn btn-danger" onclick="deleteSite(${site.id})">Âà†Èô§</button>
                    </div>
                </td>
            </tr>
        `;
        });

        html += `
                </tbody>
            </table>
        </div>
    `;

        container.innerHTML = html;
    }
    // ÁÆ°ÁêÜÁ´ôÁÇπËØÅ‰π¶
        function manageSiteCertificate(siteId, domain) {
            document.getElementById('modal-title').textContent = `ÁÆ°ÁêÜËØÅ‰π¶ - ${domain}`;
            document.getElementById('modal-body').innerHTML = `
        <div style="margin-bottom: 20px;">
            <h4>ÂΩìÂâçËØÅ‰π¶‰ø°ÊÅØ</h4>
            <div id="current-cert-info">
                <div class="loading">Âä†ËΩΩ‰∏≠...</div>
            </div>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="renew">Êõ¥Êñ∞ËØÅ‰π¶</div>
            <div class="tab" data-tab="replace">ÊõøÊç¢ËØÅ‰π¶</div>
        </div>
        
        <div id="renew-tab" class="tab-content active">
            <form id="renew-cert-form">
                <div class="form-group">
                    <label class="form-label">Êñ∞ÁöÑÊúâÊïàÊúü (Â§©)</label>
                    <input type="number" name="valid_days" class="form-control" value="365" min="1" max="3650">
                </div>
                <button type="submit" class="btn">ÈáçÊñ∞ÁîüÊàêËØÅ‰π¶</button>
            </form>
        </div>
        
        <div id="replace-tab" class="tab-content">
            <form id="replace-cert-form">
                <div class="form-group">
                    <label class="form-label">Êñ∞ÁöÑËØÅ‰π¶ÂÜÖÂÆπ (PEMÊ†ºÂºè)</label>
                    <textarea name="cert_text" class="form-control" rows="6" placeholder="-----BEGIN CERTIFICATE----- ..." required></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Êñ∞ÁöÑÁßÅÈí•ÂÜÖÂÆπ (PEMÊ†ºÂºè)</label>
                    <textarea name="key_text" class="form-control" rows="6" placeholder="-----BEGIN PRIVATE KEY----- ..." required></textarea>
                </div>
                <button type="submit" class="btn">ÊõøÊç¢ËØÅ‰π¶</button>
            </form>
        </div>
        
        <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
            <button class="btn btn-danger" onclick="removeSiteCertificate(${siteId})">
                <span>üóëÔ∏è</span> ÁßªÈô§ËØÅ‰π¶ÔºàÁ¶ÅÁî®HTTPSÔºâ
            </button>
        </div>
    `;

            // Âä†ËΩΩÂΩìÂâçËØÅ‰π¶‰ø°ÊÅØ
            loadCurrentCertificateInfo(siteId);

            // Ê†áÁ≠æÈ°µÂàáÊç¢
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function () {
                    const tabName = this.getAttribute('data-tab');

                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');

                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(`${tabName}-tab`).classList.add('active');
                });
            });

            // Ë°®ÂçïÊèê‰∫§
            document.getElementById('renew-cert-form').addEventListener('submit', function (e) {
                e.preventDefault();
                renewSiteCertificate(siteId, new FormData(this));
            });

            document.getElementById('replace-cert-form').addEventListener('submit', function (e) {
                e.preventDefault();
                replaceSiteCertificate(siteId, new FormData(this));
            });

            showModal();
        }

        // Âä†ËΩΩÂΩìÂâçËØÅ‰π¶‰ø°ÊÅØ
        async function loadCurrentCertificateInfo(siteId) {
                try {
                    const response = await fetch(`/api/site/${siteId}/certificate`, {
                        method: 'GET',
                        credentials: 'include'
                    });

                    if (response.ok) {
                        const data = await response.json();
                        displayCurrentCertificateInfo(data.certificate);
                    } else {
                        document.getElementById('current-cert-info').innerHTML =
                            '<div class="alert alert-error">Âä†ËΩΩËØÅ‰π¶‰ø°ÊÅØÂ§±Ë¥•</div>';
                    }
                } catch (error) {
                    console.error('Âä†ËΩΩËØÅ‰π¶‰ø°ÊÅØÈîôËØØ:', error);
                    document.getElementById('current-cert-info').innerHTML =
                        '<div class="alert alert-error">Âä†ËΩΩËØÅ‰π¶‰ø°ÊÅØÂ§±Ë¥•</div>';
                }
            }

       // ÊòæÁ§∫ÂΩìÂâçËØÅ‰π¶‰ø°ÊÅØ
        function displayCurrentCertificateInfo(certInfo) {
            const container = document.getElementById('current-cert-info');

            if (!certInfo || !certInfo.exists) {
                container.innerHTML = '<div class="alert">ËØ•Á´ôÁÇπÊú™ÈÖçÁΩÆËØÅ‰π¶</div>';
                return;
            }

            let html = `
        <table style="width: 100%; border-collapse: collapse;">
            <tr>
                <td style="padding: 8px; border-bottom: 1px solid #eee; font-weight: bold; width: 120px;">ÂüüÂêç</td>
                <td style="padding: 8px; border-bottom: 1px solid #eee;">${certInfo.domain}</td>
            </tr>
            <tr>
                <td style="padding: 8px; border-bottom: 1px solid #eee; font-weight: bold;">ÊúâÊïàÊúü</td>
                <td style="padding: 8px; border-bottom: 1px solid #eee;">${certInfo.valid_from} Ëá≥ ${certInfo.valid_to}</td>
            </tr>
            <tr>
                <td style="padding: 8px; border-bottom: 1px solid #eee; font-weight: bold;">Á≠æÂèëËÄÖ</td>
                <td style="padding: 8px; border-bottom: 1px solid #eee;">${certInfo.issuer}</td>
            </tr>
            <tr>
                <td style="padding: 8px; border-bottom: 1px solid #eee; font-weight: bold;">ËØÅ‰π¶Á±ªÂûã</td>
                <td style="padding: 8px; border-bottom: 1px solid #eee;">${certInfo.is_self_signed ? 'Ëá™Á≠æÂêçËØÅ‰π¶' : 'CAÁ≠æÂèëËØÅ‰π¶'}</td>
            </tr>
        </table>
    `;

            container.innerHTML = html;
        }

        // ÈáçÊñ∞ÁîüÊàêËØÅ‰π¶
            async function renewSiteCertificate(siteId, formData) {
                try {
                    const data = Object.fromEntries(formData);
                    data.valid_days = parseInt(data.valid_days) || 365;

                    const response = await fetch(`/api/site/${siteId}/renew-certificate`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        credentials: 'include',
                        body: JSON.stringify(data)
                    });

                    if (response.ok) {
                        showMessage('ËØÅ‰π¶ÈáçÊñ∞ÁîüÊàêÊàêÂäü', 'success');
                        loadCurrentCertificateInfo(siteId);
                    } else {
                        const error = await response.text();
                        showMessage('ÈáçÊñ∞ÁîüÊàêÂ§±Ë¥•: ' + error, 'error');
                    }
                } catch (error) {
                    console.error('ÈáçÊñ∞ÁîüÊàêËØÅ‰π¶ÈîôËØØ:', error);
                    showMessage('ÈáçÊñ∞ÁîüÊàêÂ§±Ë¥•', 'error');
                }
            }

        // ÊõøÊç¢ËØÅ‰π¶
        async function replaceSiteCertificate(siteId, formData) {
                try {
                    const data = Object.fromEntries(formData);

                    const response = await fetch(`/api/site/${siteId}/replace-certificate`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        credentials: 'include',
                        body: JSON.stringify(data)
                    });

                    if (response.ok) {
                        showMessage('ËØÅ‰π¶ÊõøÊç¢ÊàêÂäü', 'success');
                        loadCurrentCertificateInfo(siteId);
                    } else {
                        const error = await response.text();
                        showMessage('ÊõøÊç¢Â§±Ë¥•: ' + error, 'error');
                    }
                } catch (error) {
                    console.error('ÊõøÊç¢ËØÅ‰π¶ÈîôËØØ:', error);
                    showMessage('ÊõøÊç¢Â§±Ë¥•', 'error');
                }
            }

        // ÁßªÈô§ËØÅ‰π¶ÔºàÁ¶ÅÁî®HTTPSÔºâ
        // ÁßªÈô§ËØÅ‰π¶ÔºàÁ¶ÅÁî®HTTPSÔºâ
            async function removeSiteCertificate(siteId) {
                if (!confirm('Á°ÆÂÆöË¶ÅÁßªÈô§ËØÅ‰π¶Âπ∂Á¶ÅÁî®HTTPSÂêóÔºü')) return;

                try {
                    const response = await fetch(`/api/site/${siteId}/remove-certificate`, {
                        method: 'POST',
                        credentials: 'include'
                    });

                    if (response.ok) {
                        closeModal();
                        showMessage('ËØÅ‰π¶Â∑≤ÁßªÈô§ÔºåHTTPSÂ∑≤Á¶ÅÁî®', 'success');
                        loadSites();
                    } else {
                        const error = await response.text();
                        showMessage('ÁßªÈô§Â§±Ë¥•: ' + error, 'error');
                    }
                } catch (error) {
                    console.error('ÁßªÈô§ËØÅ‰π¶ÈîôËØØ:', error);
                    showMessage('ÁßªÈô§Â§±Ë¥•', 'error');
                }
            }

// Âä†ËΩΩÁ´ôÁÇπÂÅ•Â∫∑Áä∂ÊÄÅ
async function loadSiteHealthStatus() {
    try {
        const response = await fetch('/health', {
            method: 'GET',
            credentials: 'include'
        });

        if (response.ok) {
            const data = await response.json();
            window.siteHealthData = data.health_status; // ‰øùÂ≠òÂà∞ÂÖ®Â±ÄÂèòÈáè
            updateHealthStatusDisplay();
            
            // ÂÆöÊó∂Âà∑Êñ∞ÂÅ•Â∫∑Áä∂ÊÄÅ
            setTimeout(loadSiteHealthStatus, 3000); // ÊØè30ÁßíÂà∑Êñ∞‰∏ÄÊ¨°
        }
    } catch (error) {
        console.error('Âä†ËΩΩÂÅ•Â∫∑Áä∂ÊÄÅÈîôËØØ:', error);
        // Âá∫ÈîôÊó∂‰πüËÆæÁΩÆÂÆöÊó∂Âô®ÔºåÁ°Æ‰øùÁªßÁª≠Â∞ùËØï
        setTimeout(loadSiteHealthStatus, 30000);
    }
}

// Ëé∑ÂèñÁ´ôÁÇπÂÅ•Â∫∑Áä∂ÊÄÅHTML
function getSiteHealthStatus(siteId) {
    if (!window.siteHealthData || !window.siteHealthData[siteId]) {
        return '<span class="status-indicator">Êú™Áü•</span>';
    }
    
    const health = window.siteHealthData[siteId];
    const statusClass = health.is_alive ? 'status-active' : 'status-inactive';
    const statusText = health.is_alive ? 'Ê≠£Â∏∏' : 'ÂºÇÂ∏∏';
    const latency = health.latency ? `${health.latency}ms` : 'N/A';
    
    return `
        <span class="status-indicator ${statusClass}" title="Âª∂Ëøü: ${latency}">
            ${statusText} (${latency})
        </span>
    `;
}

// Êõ¥Êñ∞ÂÅ•Â∫∑Áä∂ÊÄÅÊòæÁ§∫
function updateHealthStatusDisplay() {
    if (currentPage === 'sites' && window.siteHealthData) {
        // ÈáçÊñ∞ÊòæÁ§∫Á´ôÁÇπÂàóË°®‰ª•Êõ¥Êñ∞ÂÅ•Â∫∑Áä∂ÊÄÅ
        loadSites();
    }
}

// Ê£ÄÊü•Âçï‰∏™Á´ôÁÇπÂÅ•Â∫∑Áä∂ÊÄÅ
async function checkSingleSiteHealth(siteId) {
    try {
        const response = await fetch(`/health/${siteId}`, {
            method: 'GET',
            credentials: 'include'
        });

        if (response.ok) {
            const data = await response.json();
            showMessage(`ÂÅ•Â∫∑Ê£ÄÊü•ÂÆåÊàê: ${data.health.is_alive ? 'Ê≠£Â∏∏' : 'ÂºÇÂ∏∏'} (${data.health.latency}ms)`, 'success');
            // Âà∑Êñ∞ÂÅ•Â∫∑Áä∂ÊÄÅÊòæÁ§∫
            loadSiteHealthStatus();
        } else {
            showMessage('ÂÅ•Â∫∑Ê£ÄÊü•Â§±Ë¥•', 'error');
        }
    } catch (error) {
        console.error('ÂÅ•Â∫∑Ê£ÄÊü•ÈîôËØØ:', error);
        showMessage('ÂÅ•Â∫∑Ê£ÄÊü•Â§±Ë¥•', 'error');
    }
}
       // ‰øÆÊîπshowAddSiteModalÂáΩÊï∞
        function showAddSiteModal() {
            document.getElementById('modal-title').textContent = 'Ê∑ªÂä†Á´ôÁÇπ';
            document.getElementById('modal-body').innerHTML = `
        <form id="add-site-form">
            <div class="form-group">
                <label class="form-label">Á´ôÁÇπÂêçÁß∞</label>
                <input type="text" name="name" class="form-control" placeholder="‰æãÂ¶Ç: ÊàëÁöÑÁΩëÁ´ô" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">ÂüüÂêç</label>
                <input type="text" name="domain" class="form-control" placeholder="‰æãÂ¶Ç: example.com" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">ÁõÆÊ†áURL</label>
                <input type="text" name="target_url" class="form-control" placeholder="‰æãÂ¶Ç: http://127.0.0.1:8080" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">ÂêØÁî®HTTPS</label>
                <div>
                    <label style="display: inline-flex; align-items: center; gap: 8px; margin-right: 20px;">
                        <input type="radio" name="enable_https" value="true"> ÂêØÁî®
                    </label>
                    <label style="display: inline-flex; align-items: center; gap: 8px;">
                        <input type="radio" name="enable_https" value="false" checked> Á¶ÅÁî®
                    </label>
                </div>
            </div>
            
            <div class="form-group" id="https-options" style="display: none;">
                <div class="tabs" id="cert-tabs">
                    <div class="tab active" data-tab="auto">Ëá™Âä®ÁîüÊàêËØÅ‰π¶</div>
                    <div class="tab" data-tab="upload">‰∏ä‰º†ËØÅ‰π¶</div>
                </div>
                
                <div id="auto-cert-tab" class="tab-content active">
                    <div class="form-group">
                        <label class="form-label">ËØÅ‰π¶ÊúâÊïàÊúü (Â§©)</label>
                        <input type="number" name="valid_days" class="form-control" value="365" min="1" max="3650">
                        <small style="color: #666;">ÈªòËÆ§365Â§©ÔºåÊúÄÈïø10Âπ¥</small>
                    </div>
                </div>
                
                <div id="upload-cert-tab" class="tab-content">
                    <div class="form-group">
                        <label class="form-label">ËØÅ‰π¶ÂÜÖÂÆπ (PEMÊ†ºÂºè)</label>
                        <textarea name="cert_text" class="form-control" rows="6" placeholder="-----BEGIN CERTIFICATE----- ..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ÁßÅÈí•ÂÜÖÂÆπ (PEMÊ†ºÂºè)</label>
                        <textarea name="key_text" class="form-control" rows="6" placeholder="-----BEGIN PRIVATE KEY----- ..."></textarea>
                    </div>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button type="button" class="btn btn-secondary" onclick="closeModal()">ÂèñÊ∂à</button>
                <button type="submit" class="btn">Ê∑ªÂä†Á´ôÁÇπ</button>
            </div>
        </form>
    `;

            // ÊòæÁ§∫/ÈöêËóèHTTPSÈÄâÈ°π
            document.querySelectorAll('input[name="enable_https"]').forEach(radio => {
                radio.addEventListener('change', function () {
                    document.getElementById('https-options').style.display = this.value === 'true' ? 'block' : 'none';
                });
            });

            // ËØÅ‰π¶Ê†áÁ≠æÈ°µÂàáÊç¢
            document.querySelectorAll('#cert-tabs .tab').forEach(tab => {
                tab.addEventListener('click', function () {
                    const tabName = this.getAttribute('data-tab');

                    // Êõ¥Êñ∞Ê†áÁ≠æÁä∂ÊÄÅ
                    document.querySelectorAll('#cert-tabs .tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');

                    // ÊòæÁ§∫ÂØπÂ∫îÂÜÖÂÆπ
                    document.querySelectorAll('#https-options .tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(`${tabName}-cert-tab`).classList.add('active');
                });
            });

            // Ë°®ÂçïÊèê‰∫§
            document.getElementById('add-site-form').addEventListener('submit', function (e) {
                e.preventDefault();
                addSiteWithCertificate(new FormData(this));
            });

            showModal();
        }
        // ‰øÆÊîπÊ∑ªÂä†Á´ôÁÇπÂáΩÊï∞ÔºåÊîØÊåÅËØÅ‰π¶
            async function addSiteWithCertificate(formData) {
                try {
                    const data = Object.fromEntries(formData);
                    data.enable_https = data.enable_https === 'true';

                    const response = await fetch('/api/site/add-with-cert', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        credentials: 'include',
                        body: JSON.stringify(data)
                    });

                    if (response.ok) {
                        closeModal();
                        showMessage('Á´ôÁÇπÊ∑ªÂä†ÊàêÂäü', 'success');
                        loadSites();
                    } else {
                        const error = await response.text();
                        showMessage('Ê∑ªÂä†Â§±Ë¥•: ' + error, 'error');
                    }
                } catch (error) {
                    console.error('Ê∑ªÂä†Á´ôÁÇπÈîôËØØ:', error);
                    showMessage('Ê∑ªÂä†Â§±Ë¥•', 'error');
                }
            }

        // Ê∑ªÂä†Á´ôÁÇπ
        async function addSite(formData) {
            try {
                const data = Object.fromEntries(formData);
                data.enable_https = data.enable_https === 'true';
                
                const response = await fetch('/api/site/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    closeModal();
                    showMessage('Á´ôÁÇπÊ∑ªÂä†ÊàêÂäü', 'success');
                    loadSites();
                } else {
                    const error = await response.text();
                    showMessage('Ê∑ªÂä†Â§±Ë¥•: ' + error, 'error');
                }
            } catch (error) {
                console.error('Ê∑ªÂä†Á´ôÁÇπÈîôËØØ:', error);
                showMessage('Ê∑ªÂä†Â§±Ë¥•', 'error');
            }
        }

        // Âà†Èô§Á´ôÁÇπ
        async function deleteSite(id) {
            if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™Á´ôÁÇπÂêóÔºü')) return;
            
            try {
                const response = await fetch('/api/site/delete', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({ id })
                });

                if (response.ok) {
                    showMessage('Á´ôÁÇπÂà†Èô§ÊàêÂäü', 'success');
                    loadSites();
                } else {
                    showMessage('Âà†Èô§Â§±Ë¥•', 'error');
                }
            } catch (error) {
                console.error('Âà†Èô§Á´ôÁÇπÈîôËØØ:', error);
                showMessage('Âà†Èô§Â§±Ë¥•', 'error');
            }
        }

        // Âä†ËΩΩÊîªÂáªÊó•Âøó
        async function loadAttackLogs(page) {
            try {
                currentLogsPage = page;
                
                const params = new URLSearchParams({
                    page: page,
                    page_size: currentLogsPageSize
                });
                
                // Ê∑ªÂä†Á≠õÈÄâÊù°‰ª∂
                const methodFilter = document.getElementById('log-method-filter');
                const ruleFilter = document.getElementById('log-rule-filter');
                const startDate = document.getElementById('log-start-date');
                const endDate = document.getElementById('log-end-date');
                
                if (methodFilter && methodFilter.value) params.append('method', methodFilter.value);
                if (ruleFilter && ruleFilter.value) params.append('rule_name', ruleFilter.value);
                if (startDate && startDate.value) params.append('start_time', startDate.value);
                if (endDate && endDate.value) params.append('end_time', endDate.value);
                
                const response = await fetch(`/api/attack/logs?${params}`, {
                    method: 'GET',
                    credentials: 'include'
                });

                if (response.ok) {
                    const data = await response.json();
                    displayAttackLogs(data);
                } else {
                    document.getElementById('logs-container').innerHTML = '<div class="alert alert-error">Âä†ËΩΩÊîªÂáªÊó•ÂøóÂ§±Ë¥•</div>';
                }
            } catch (error) {
                console.error('Âä†ËΩΩÊîªÂáªÊó•ÂøóÈîôËØØ:', error);
                document.getElementById('logs-container').innerHTML = '<div class="alert alert-error">Âä†ËΩΩÊîªÂáªÊó•ÂøóÂ§±Ë¥•</div>';
            }
        }

        // ÊòæÁ§∫ÊîªÂáªÊó•Âøó
        function displayAttackLogs(data) {
            const container = document.getElementById('logs-container');
            currentLogsTotal = data.total;
            
            if (!data.logs || data.logs.length === 0) {
                container.innerHTML = '<div class="alert">ÊöÇÊó†ÊîªÂáªÊó•Âøó</div>';
                document.getElementById('logs-pagination').innerHTML = '';
                return;
            }
            
            let html = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Êó∂Èó¥</th>
                                <th>ÊñπÊ≥ï</th>
                                <th>ËßÑÂàôÂêçÁß∞</th>
                                <th>ËßÑÂàôID</th>
                                <th>ÂåπÈÖçÂÜÖÂÆπ</th>
                                <th>URL</th>
                                <th>Êìç‰Ωú</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            data.logs.forEach(log => {
                html += `
                    <tr>
                        <td>${log.created_at}</td>
                        <td>${log.method}</td>
                        <td>${log.rule_name}</td>
                        <td>${log.rule_id}</td>
                        <td title="${log.matched_value}">${log.matched_value.length > 30 ? log.matched_value.substring(0, 30) + '...' : log.matched_value}</td>
                        <td title="${log.url}">${log.url.length > 30 ? log.url.substring(0, 30) + '...' : log.url}</td>
                        <td>
                            <button class="btn" onclick="showLogDetail(${log.id})">ËØ¶ÊÉÖ</button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            container.innerHTML = html;
            
            // ÊòæÁ§∫ÂàÜÈ°µ
            displayPagination(data.total, data.page_size, data.page);
        }

        // ÊòæÁ§∫ÂàÜÈ°µ
        function displayPagination(total, pageSize, currentPage) {
            const totalPages = Math.ceil(total / pageSize);
            const pagination = document.getElementById('logs-pagination');
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }
            
            let html = '';
            
            // ‰∏ä‰∏ÄÈ°µ
            if (currentPage > 1) {
                html += `<button class="page-btn" onclick="loadAttackLogs(${currentPage - 1})">‰∏ä‰∏ÄÈ°µ</button>`;
            }
            
            // È°µÁ†Å
            for (let i = 1; i <= totalPages; i++) {
                if (i === currentPage) {
                    html += `<button class="page-btn active">${i}</button>`;
                } else if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    html += `<button class="page-btn" onclick="loadAttackLogs(${i})">${i}</button>`;
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    html += `<span class="page-btn">...</span>`;
                }
            }
            
            // ‰∏ã‰∏ÄÈ°µ
            if (currentPage < totalPages) {
                html += `<button class="page-btn" onclick="loadAttackLogs(${currentPage + 1})">‰∏ã‰∏ÄÈ°µ</button>`;
            }
            
            pagination.innerHTML = html;
        }

        // ÊòæÁ§∫Êó•ÂøóËØ¶ÊÉÖ
        function showLogDetail(logId) {
            // ËøôÈáåÂèØ‰ª•ÊòæÁ§∫Êõ¥ËØ¶ÁªÜÁöÑÊó•Âøó‰ø°ÊÅØ
            alert('Êó•ÂøóËØ¶ÊÉÖÂäüËÉΩÂæÖÂÆûÁé∞');
        }

        // ÂØºÂá∫Êó•Âøó
        function exportLogs() {
            // ÊûÑÂª∫ÂØºÂá∫URL
            const params = new URLSearchParams();
            
            const methodFilter = document.getElementById('log-method-filter');
            const ruleFilter = document.getElementById('log-rule-filter');
            const startDate = document.getElementById('log-start-date');
            const endDate = document.getElementById('log-end-date');
            
            if (methodFilter && methodFilter.value) params.append('method', methodFilter.value);
            if (ruleFilter && ruleFilter.value) params.append('rule_name', ruleFilter.value);
            if (startDate && startDate.value) params.append('start_time', startDate.value);
            if (endDate && endDate.value) params.append('end_time', endDate.value);
            
            window.open(`/api/attack/export?${params}`, '_blank');
        }

        // ÊòæÁ§∫Âà†Èô§Êó•ÂøóÊ®°ÊÄÅÊ°Ü
        function showDeleteLogsModal() {
            document.getElementById('modal-title').textContent = 'Âà†Èô§ÊîªÂáªÊó•Âøó';
            document.getElementById('modal-body').innerHTML = `
                <form id="delete-logs-form">
                    <div class="form-group">
                        <label class="form-label">Âà†Èô§ÊñπÂºè</label>
                        <div>
                            <label style="display: block; margin-bottom: 10px;">
                                <input type="radio" name="delete_type" value="all" checked> Âà†Èô§ÊâÄÊúâÊó•Âøó
                            </label>
                            <label style="display: block; margin-bottom: 10px;">
                                <input type="radio" name="delete_type" value="before"> Âà†Èô§ÊåáÂÆöÊó∂Èó¥‰πãÂâçÁöÑÊó•Âøó
                                <input type="date" name="before_date" class="form-control" style="margin-top: 5px;">
                            </label>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button type="button" class="btn btn-secondary" onclick="closeModal()">ÂèñÊ∂à</button>
                        <button type="submit" class="btn btn-danger">Âà†Èô§</button>
                    </div>
                </form>
            `;
            
            document.getElementById('delete-logs-form').addEventListener('submit', function(e) {
                e.preventDefault();
                deleteLogs(new FormData(this));
            });
            
            showModal();
        }

        // ÂàáÊç¢Á´ôÁÇπHTTPSÁä∂ÊÄÅ
async function toggleSiteHTTPS(siteId, enableHTTPS) {
    const action = enableHTTPS ? 'ÂêØÁî®' : 'Á¶ÅÁî®';
    
    if (!confirm(`Á°ÆÂÆöË¶Å${action}Ëøô‰∏™Á´ôÁÇπÁöÑHTTPSÂêóÔºü`)) return;
    
    try {
        const requestData = {
            id: siteId,
            enable_https: enableHTTPS
        };
        
        // ÂêØÁî®HTTPSÊó∂‰∏çÂÜçÈúÄË¶ÅÊâãÂä®ËæìÂÖ•ËØÅ‰π¶IDÔºåÂêéÁ´Ø‰ºöËá™Âä®Â§ÑÁêÜ
        // Â¶ÇÊûúÁ´ôÁÇπÂ∑≤ÊúâËØÅ‰π¶‰ºö‰ΩøÁî®Áé∞ÊúâËØÅ‰π¶ÔºåÂ¶ÇÊûúÊ≤°ÊúâÂàôËá™Âä®ÁîüÊàê
        
        const response = await fetch('/api/site/https', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            credentials: 'include',
            body: JSON.stringify(requestData)
        });

        if (response.ok) {
            showMessage(`Á´ôÁÇπHTTPS${action}ÊàêÂäü`, 'success');
            loadSites();
        } else {
            const error = await response.text();
            showMessage(`${action}HTTPSÂ§±Ë¥•: ${error}`, 'error');
        }
    } catch (error) {
        console.error(`${action}Á´ôÁÇπHTTPSÈîôËØØ:`, error);
        showMessage(`${action}HTTPSÂ§±Ë¥•`, 'error');
    }
}

// ‰øÆÊîπ displayLogDetailModal ÂáΩÊï∞ÔºåÁ°Æ‰øùÊâÄÊúâÂ≠óÊÆµÈÉΩÊòØÂ≠óÁ¨¶‰∏≤
function displayLogDetailModal(log) {
    document.getElementById('modal-title').textContent = `ÊîªÂáªÊó•ÂøóËØ¶ÊÉÖ - ID: ${log.id}`;
    
    // Ê†ºÂºèÂåñÊó∂Èó¥
    const formattedTime = new Date(log.created_at).toLocaleString();
    
    // ÊûÑÂª∫Ê†ºÂºèÂåñÁöÑHTTPËØ∑Ê±Ç
    function formatHTTPRequest(log) {
        let request = '';
        
        // ËØ∑Ê±ÇË°å
        const method = String(log.method || 'GET');
        const url = String(log.url || '/');
        const httpVersion = 'HTTP/1.1';
        
        request += `${method} ${url} ${httpVersion}\n`;
        
        // Ëß£ÊûêËØ∑Ê±ÇÂ§¥
        if (log.headers && String(log.headers).trim()) {
            const headers = String(log.headers).split('\n');
            headers.forEach(header => {
                if (header.trim()) {
                    const trimmedHeader = header.trim();
                    if (trimmedHeader.includes(':')) {
                        const [name, ...valueParts] = trimmedHeader.split(':');
                        const value = valueParts.join(':').trim();
                        
                        const prettyName = name.toLowerCase()
                            .split('-')
                            .map(part => part.charAt(0).toUpperCase() + part.slice(1))
                            .join('-');
                        
                        request += `${prettyName}: ${value}\n`;
                    } else {
                        request += `${trimmedHeader}\n`;
                    }
                }
            });
        } else {
            request += 'Host: unknown\n';
        }
        
        request += '\n';
        
        // ËØ∑Ê±Ç‰Ωì
        if (log.body && String(log.body).trim()) {
            request += String(log.body);
        }
        
        return request;
    }
    
    const formattedRequest = formatHTTPRequest(log);
    
    // ÊûÑÂª∫ËØ¶ÊÉÖÂÜÖÂÆπ
    document.getElementById('modal-body').innerHTML = `
        <div style="max-height: 70vh; overflow-y: auto;">
            <div class="card" style="margin-bottom: 15px;">
                <h4 style="margin-bottom: 10px; color: #5210ed;">Âü∫Êú¨‰ø°ÊÅØ</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #eee; font-weight: bold; width: 120px;">Êó∂Èó¥</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">${formattedTime}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #eee; font-weight: bold;">ËØ∑Ê±ÇÊñπÊ≥ï</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">
                            <span class="status-indicator ${log.method === 'GET' ? 'status-active' : 'status-inactive'}">
                                ${String(log.method || 'Unknown')}
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #eee; font-weight: bold;">ËßÑÂàôÂêçÁß∞</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">${String(log.rule_name || 'Unknown')}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #eee; font-weight: bold;">ËßÑÂàôID</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">${String(log.rule_id || 'Unknown')}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #eee; font-weight: bold;">ÂåπÈÖçÂÜÖÂÆπ</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">
                            <code style="background: #f4f4f4; padding: 2px 4px; border-radius: 3px; word-break: break-all;">
                                ${escapeHtml(log.matched_value)}
                            </code>
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #eee; font-weight: bold;">ÂÆ¢Êà∑Á´ØIP</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">${String(log.client_ip || 'Unknown')}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #eee; font-weight: bold;">Áî®Êà∑‰ª£ÁêÜ</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">
                            <code style="background: #f4f4f4; padding: 2px 4px; border-radius: 3px; word-break: break-all;">
                                ${escapeHtml(log.user_agent)}
                            </code>
                        </td>
                    </tr>
                </table>
            </div>

            <div class="card">
                <h4 style="margin-bottom: 10px; color: #5210ed;">HTTPËØ∑Ê±ÇËØ¶ÊÉÖ</h4>
                <div style="position: relative;">
                    <button type="button" class="btn" onclick="copyFormattedRequest()" 
                            style="position: absolute; top: 10px; right: 10px; z-index: 10; padding: 5px 10px; font-size: 12px;">
                        üìã Â§çÂà∂ËØ∑Ê±Ç
                    </button>
                    <div id="formatted-request" style="background: #f8f9fa; padding: 20px; border-radius: 8px; font-family: 'Courier New', monospace; white-space: pre-wrap; word-break: break-all; max-height: 400px; overflow-y: auto; line-height: 1.4; font-size: 13px; border: 1px solid #e9ecef; margin-top: 10px;">
${escapeHtml(formattedRequest)}
                    </div>
                </div>
                
                ${log.url_decoded && String(log.url_decoded) !== String(log.url) ? `
                <div style="margin-top: 15px;">
                    <h5 style="color: #5210ed; margin-bottom: 8px;">Ëß£Á†ÅÂêéURL:</h5>
                    <div style="background: #e8f4fd; padding: 10px; border-radius: 5px; font-family: monospace; word-break: break-all; font-size: 13px;">
                        ${escapeHtml(log.url_decoded)}
                    </div>
                </div>
                ` : ''}
                
                ${log.headers_decoded && String(log.headers_decoded) !== String(log.headers) ? `
                <div style="margin-top: 15px;">
                    <h5 style="color: #5210ed; margin-bottom: 8px;">Ëß£Á†ÅÂêéËØ∑Ê±ÇÂ§¥:</h5>
                    <div style="background: #e8f4fd; padding: 10px; border-radius: 5px; font-family: monospace; white-space: pre-wrap; word-break: break-all; font-size: 13px;">
                        ${escapeHtml(log.headers_decoded)}
                    </div>
                </div>
                ` : ''}
                
                ${log.body_decoded && String(log.body_decoded) !== String(log.body) ? `
                <div style="margin-top: 15px;">
                    <h5 style="color: #5210ed; margin-bottom: 8px;">Ëß£Á†ÅÂêéËØ∑Ê±Ç‰Ωì:</h5>
                    <div style="background: #e8f4fd; padding: 10px; border-radius: 5px; font-family: monospace; white-space: pre-wrap; word-break: break-all; font-size: 13px;">
                        ${escapeHtml(log.body_decoded)}
                    </div>
                </div>
                ` : ''}
            </div>
        </div>

        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
            <button type="button" class="btn btn-secondary" onclick="closeModal()">ÂÖ≥Èó≠</button>
            <button type="button" class="btn" onclick="copyLogDetails()">Â§çÂà∂ÂÖ®ÈÉ®ËØ¶ÊÉÖ</button>
        </div>
    `;
    
    showModal();
}


// HTMLËΩ¨‰πâÂáΩÊï∞
// ‰øÆÊîπ escapeHtml ÂáΩÊï∞ÔºåÊ∑ªÂä†Á±ªÂûãÊ£ÄÊü•
function escapeHtml(unsafe) {
    if (!unsafe) return '';
    
    // Â¶ÇÊûúÊòØÂØπË±°ÔºåËΩ¨Êç¢‰∏∫ JSON Â≠óÁ¨¶‰∏≤
    if (typeof unsafe === 'object') {
        try {
            unsafe = JSON.stringify(unsafe, null, 2);
        } catch (e) {
            unsafe = String(unsafe);
        }
    }
    
    // Á°Æ‰øùÊòØÂ≠óÁ¨¶‰∏≤
    unsafe = String(unsafe);
    
    return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
}


// Â§çÂà∂Ê†ºÂºèÂåñÁöÑHTTPËØ∑Ê±Ç
function copyFormattedRequest() {
    const formattedRequest = document.getElementById('formatted-request').textContent;
    
    navigator.clipboard.writeText(formattedRequest).then(() => {
        showMessage('HTTPËØ∑Ê±ÇÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø', 'success');
    }).catch(err => {
        console.error('Â§çÂà∂Â§±Ë¥•:', err);
        showMessage('Â§çÂà∂Â§±Ë¥•', 'error');
    });
}



// HTMLËΩ¨‰πâÂáΩÊï∞
function escapeHtml(unsafe) {
    if (!unsafe) return '';
    return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
}

// Â§çÂà∂Êó•ÂøóËØ¶ÊÉÖ
function copyLogDetails() {
    const modalBody = document.getElementById('modal-body');
    const text = modalBody.innerText;
    
    navigator.clipboard.writeText(text).then(() => {
        showMessage('Êó•ÂøóËØ¶ÊÉÖÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø', 'success');
    }).catch(err => {
        console.error('Â§çÂà∂Â§±Ë¥•:', err);
        showMessage('Â§çÂà∂Â§±Ë¥•', 'error');
    });
}

// ÊòæÁ§∫Êó•ÂøóËØ¶ÊÉÖ
async function showLogDetail(logId) {
    try {
        const response = await fetch(`/api/attack/logs/${logId}`, {
            method: 'GET',
            credentials: 'include'
        });

        if (response.ok) {
            const data = await response.json();
            if (data.log) {
                displayLogDetailModal(data.log);
            } else {
                showMessage('Êó•ÂøóÊï∞ÊçÆÊ†ºÂºèÈîôËØØ', 'error');
            }
        } else {
            showMessage('Ëé∑ÂèñÊó•ÂøóËØ¶ÊÉÖÂ§±Ë¥•', 'error');
        }
    } catch (error) {
        console.error('Ëé∑ÂèñÊó•ÂøóËØ¶ÊÉÖÈîôËØØ:', error);
        showMessage('Ëé∑ÂèñÊó•ÂøóËØ¶ÊÉÖÂ§±Ë¥•: ' + error.message, 'error');
    }
}

        // Âà†Èô§Êó•Âøó
        async function deleteLogs(formData) {
            try {
                const data = Object.fromEntries(formData);
                let requestData = {};
                
                if (data.delete_type === 'all') {
                    requestData.all = true;
                } else if (data.delete_type === 'before' && data.before_date) {
                    requestData.before = data.before_date;
                } else {
                    showMessage('ËØ∑ÈÄâÊã©Âà†Èô§Êù°‰ª∂', 'error');
                    return;
                }
                
                const response = await fetch('/api/attack/logs', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify(requestData)
                });

                if (response.ok) {
                    closeModal();
                    showMessage('ÊîªÂáªÊó•ÂøóÂà†Èô§ÊàêÂäü', 'success');
                    loadAttackLogs(1);
                } else {
                    const error = await response.text();
                    showMessage('Âà†Èô§Â§±Ë¥•: ' + error, 'error');
                }
            } catch (error) {
                console.error('Âà†Èô§Êó•ÂøóÈîôËØØ:', error);
                showMessage('Âà†Èô§Â§±Ë¥•', 'error');
            }
        }

        // Âä†ËΩΩËÆæÁΩÆ
        function loadSettings() {
            // ËøôÈáåÂèØ‰ª•Âä†ËΩΩÂΩìÂâçËÆæÁΩÆÂÄº
            document.getElementById('rule-match-rate').addEventListener('input', function() {
                document.getElementById('rule-match-rate-value').textContent = this.value + '%';
            });
        }

        // ‰øùÂ≠òËÆæÁΩÆ
        function saveSettings() {
            // ËøôÈáåÂèØ‰ª•‰øùÂ≠òËÆæÁΩÆÂà∞ÂêéÁ´Ø
            showMessage('ËÆæÁΩÆÂ∑≤‰øùÂ≠ò', 'success');
        }

        // Ê®°ÊÄÅÊ°ÜÂäüËÉΩ
        function showModal() {
            document.getElementById('modal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        // Ê∂àÊÅØÊèêÁ§∫
        function showMessage(message, type) {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            
            document.getElementById('content-container').insertBefore(alert, document.getElementById('content-container').firstChild);
            
            setTimeout(() => {
                alert.remove();
            }, 3000);
        }

        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // ÂàùÂßãÂåñÊ®°ÊÄÅÊ°ÜÂÖ≥Èó≠ÂäüËÉΩ
            document.querySelector('.close-modal').addEventListener('click', closeModal);
            document.getElementById('modal').addEventListener('click', function(e) {
                if (e.target === this) closeModal();
            });
            
            // Âä†ËΩΩÁ¨¨‰∏Ä‰∏™È°µÈù¢
            loadPage('dashboard');
            
            // ÊØè10ÁßíËá™Âä®Âà∑Êñ∞ÁªüËÆ°Êï∞ÊçÆ
            setInterval(() => {
                if (currentPage === 'dashboard') {
                    loadStats();
                }
            }, 10000);
             // ÂàùÂßãÂä†ËΩΩÂÅ•Â∫∑Áä∂ÊÄÅ
            loadSiteHealthStatus();
        });
    </script>
</body>

</html>
